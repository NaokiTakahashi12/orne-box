<?xml version="1.0"?>
<launch>
  <arg name="namespace" default="cost_cloud_postprocessing"/>
  <arg name="output" default="screen"/>
  <arg name="respawn" default="true"/>
  <arg name="cloud_source" default="/rfans/surestar_points"/>
  <arg name="cost_cloud_topic" default="cost_cloud"/>
  <arg name="output_frame_id" default="base_link"/>
  <arg name="manager" default="cost_cloud_manager"/>
  <arg name="field_name" default="z"/>
  <arg name="limit_min" default="0.1"/>
  <arg name="limit_max" default="0.8"/>
  <group ns="$(arg namespace)" clear_params="true">
    <node pkg="nodelet" type="nodelet" name="$(arg manager)" args="manager" respawn="$(arg respawn)">
    </node>
    <node pkg="nodelet" type="nodelet" name="crop_box_filter" args="load pcl/CropBox $(arg manager) $(arg respawn)" respawn="$(arg respawn)">
      <param name="filter_field_name" value="$(arg field_name)"/>
      <param name="filter_limit_min" value="$(arg limit_min)"/>
      <param name="filter_limit_max" value="$(arg limit_max)"/>
      <param name="negative" value="true"/>
      <param name="min_x" value="-0.75"/>
      <param name="max_x" value="0.0"/>
      <param name="min_y" value="-0.5"/>
      <param name="max_y" value="0.5"/>
      <param name="output_frame" value="$(arg output_frame_id)"/>
      <remap from="~input" to="$(arg cloud_source)"/>
      <remap from="~output" to="crop_box"/>
    </node>
    <node pkg="nodelet" type="nodelet" name="voxel_grid_filter" args="load pcl/VoxelGrid $(arg manager) $(arg respawn)" respawn="$(arg respawn)">
      <param name="filter_field_name" value="$(arg field_name)"/>
      <param name="filter_limit_min" value="$(arg limit_min)"/>
      <param name="filter_limit_max" value="$(arg limit_max)"/>
      <param name="leaf_size" value="0.1"/>
      <param name="min_points_per_voxel" value="0.05"/>
      <param name="output_frame" value="$(arg output_frame_id)"/>
      <remap from="~input" to="crop_box"/>
      <remap from="~output" to="voxel_grid"/>
    </node>
    <node pkg="nodelet" type="nodelet" name="pass_through_filter" args="load pcl/PassThrough $(arg manager) $(arg respawn)" respawn="$(arg respawn)">
      <param name="filter_field_name" value="$(arg field_name)"/>
      <param name="filter_limit_min" value="$(arg limit_min)"/>
      <param name="filter_limit_max" value="$(arg limit_max)"/>
      <param name="filter_limit_negative" value="false"/>
      <param name="output_frame" value="$(arg output_frame_id)"/>
      <remap from="~input" to="voxel_grid"/>
      <remap from="~output" to="pass_through"/>
    </node>
    <node pkg="nodelet" type="nodelet" name="statistical_outlier_remover" args="load pcl/StatisticalOutlierRemoval $(arg manager) $(arg respawn)" respawn="$(arg respawn)">
      <param name="filter_field_name" value="$(arg field_name)"/>
      <param name="filter_limit_min" value="$(arg limit_min)"/>
      <param name="filter_limit_max" value="$(arg limit_max)"/>
      <param name="filter_limit_negative" value="false"/>
      <param name="mean_k" value="4"/>
      <param name="stddev" value="0.1"/>
      <param name="output_frame" value="$(arg output_frame_id)"/>
      <remap from="~input" to="pass_through"/>
      <remap from="~output" to="statistical_outlier_removed"/>
    </node>
    <node pkg="nodelet" type="nodelet" name="radius_outlier_remover" args="load pcl/RadiusOutlierRemoval $(arg manager) $(arg respawn)" respawn="$(arg respawn)">
      <param name="filter_field_name" value="$(arg field_name)"/>
      <param name="filter_limit_min" value="$(arg limit_min)"/>
      <param name="filter_limit_max" value="$(arg limit_max)"/>
      <param name="filter_limit_negative" value="false"/>
      <param name="radius_search" value="0.1"/>
      <param name="min_neighbors" value="3"/>
      <param name="output_frame" value="$(arg output_frame_id)"/>
      <remap from="~input" to="statistical_outlier_removed"/>
      <remap from="~output" to="$(arg cost_cloud_topic)"/>
    </node>
   </group>
</launch>
